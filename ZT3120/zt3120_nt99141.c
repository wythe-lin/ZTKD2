//
// Zealtek D2 project
// ZT3120@NT99141 solutions
//
// Zealtek internal usage only.
// All files in this project cannot be released to customers.
//
// Sep 11, 2012.

#include "system.h"
#include "d2.h"
#include "gendef.h"
#include "sensor0.h"
#include "sensor1.h"

#ifdef SUPPORT_D2_OPERATION

	// Compiler Options for NT99141 image sensors.
	//
	#define CLK_SENSOR  24
	#if (CLK_PLL / CLK_SENSOR >= 16)
		#error Maximum Clock Divider for CLK_SENSOR is 16.
	#endif // (CLK_PLL / CLK_SENSOR >= 16)

	#define SENSOR_ONCHIP_LDO
	#define DRIVING_ABILITY 1 // for customer target boards
	//#define DRIVING_ABILITY 2 // for NTK sensor daughter boards

	//#define SENSOR_AE_SPEED 0x07 // Slowest Setting
	#define SENSOR_AE_SPEED 0x37 // NTK Setting for MCLK_24_PCLK_72_24_FPS
	//#define SENSOR_AE_SPEED 0x87 // NTK Setting for MCLK_24_PCLK_60_24_FPS
	//#define SENSOR_AE_SPEED 0xF7 // Fastest Setting

	//#define SENSOR_AGC_GAIN 0x20 // Maximum AGC Gain
	//#define SENSOR_AGC_GAIN 0x28 // Maximum AGC Gain, by NTK K.H. 2013/01/09 6x
	//#define SENSOR_AGC_GAIN 0x2A // Maximum AGC Gain, by NTK K.H. 2012/12/03
	#define SENSOR_AGC_GAIN 0x2B // Maximum AGC Gain, by NTK K.H. 2013/01/31 7x
	//#define SENSOR_AGC_GAIN 0x30 // Maximum AGC Gain, by NTK K.H. 2012/12/20 8x

	#define SENSOR_HORIZONTAL_MIRROR 0x00 // Mirror OFF
	//#define SENSOR_HORIZONTAL_MIRROR 0x02 // Mirror ON
	#define SENSOR_VERTICAL_FLIP     0x00 // Flip OFF
	//#define SENSOR_VERTICAL_FLIP     0x01 // Flip ON

	// NT99141 PLL settings:
	//
	// PLL_CLK = M_CLK * (PLL_M + 1) / (2 * (PLL_N + 1) * (PLL_P + 1))
	//         = M_CLK * (0x3028[5:0] + 1) / (2 * (0x3029[5:4] + 1) * (0x3029[2:0] + 1))
	// P_CLK   = PLL_CLK / CLK_DIV
	//         = PLL_CLK / (2 ^ 0x302A[3:2])
	//
	// HD Mode Settings
	//#define MCLK_24_PCLK_74_30_FPS
	#define MCLK_24_PCLK_72_24_FPS
	//#define MCLK_24_PCLK_60_24_FPS
	#define SENSOR_CROP_960x544

	// VGA Mode Settings
	//#define MCLK_24_PCLK_XX_30_FPS
	#define MCLK_24_PCLK_60_30_FPS

	#if ZT3120_DECODER == ZT3120_DECODER_ADV7180

tI2CRegister0 code I2CInitTableNTSC[] =
{
	//{0x00, 0x04},	// Composite decoder Channel; 0000b = auto detect PAL B/G/H/I/D, NTSC J, SECAM
	//{0x00, 0x14},	// Composite decoder Channel; 0001b = auto detect PAL B/G/H/I/D, NTSC M, SECAM
	{0x00, 0x54},	// Composite decoder Channel; 0101b = NTSC M
	//{0x04, 0x57},	// Enable SFL
	{0x04, 0xD7},	// To fix display blank issue.
	{0x17, 0x41}, // Select SH1
	{0x31, 0x02}, // Clear NEWAVMODE, SAV/EAV to suit ADV video encoders
	{0x3d, 0xa2}, // Color Kill
	{0x3e, 0x6a}, // BLM optimization
	{0x3f, 0xa0}, // BGB optimization
	{0x0e, 0x80}, // Enter hidden space
	{0x55, 0x81}, // ADC configuration
	{0x0e, 0x00}, // Enter user space
	//{0x08, 0x88}, // Contrast
};


tI2CRegister0 code I2CInitTablePAL[] =
{
	//{0x00, 0x04},	// Composite decoder Channel; 0000b = auto detect PAL B/G/H/I/D, NTSC J, SECAM
	//{0x00, 0x14},	// Composite decoder Channel; 0001b = auto detect PAL B/G/H/I/D, NTSC M, SECAM
	{0x00, 0x84},	// Composite decoder Channel; 1000b = PAL B/G/H/I/D
	//{0x04, 0x57},	// Enable SFL
	{0x04, 0xD7},	// To fix display blank issue.
	{0x17, 0x41}, // Select SH1
	{0x31, 0x02}, // Clear NEWAVMODE, SAV/EAV to suit ADV video encoders
	{0x3d, 0xa2}, // Color Kill
	{0x3e, 0x6a}, // BLM optimization
	{0x3f, 0xa0}, // BGB optimization
	{0x0e, 0x80}, // Enter hidden space
	{0x55, 0x81}, // ADC configuration
	{0x0e, 0x00}, // Enter user space
	//{0x08, 0x88}, // Contrast
};

	#elif ZT3120_DECODER == ZT3120_DECODER_T515B

tI2CRegister0 code I2CInitTableNTSC[] =
{
	{0x5F, 0x01},			//RESET
	{0x0A, 0x20},
	{0x0F, 0x00},
	{0x11, 0x0C},
	{0x18, 0x00},			//$B0,W,Y,$0000,18,00,48,83,
	{0x19, 0x0A},			//0x0A, 0x08
	//{0x19, 0x08},
	//{0x1A, 0x83},
	{0x20, 0x00},			//Video Source: NTSC
	{0x21, 0x09},
	{0x59, 0x8A},			//Video 0:Odd Fields; 1:Even Fields
	//{0x59, 0x0A},			//Video 1:Odd Fields; 0:Even Fields
	{0xD2, 0x26},
	{0xD6, 0x01},
	{0xE0, 0xB0},

	{0x38, 0x21},
	{0x39, 0xF0},
	{0x3A, 0x7C},
	{0x3B, 0x0F},
	//{0x27, 0x20},		//blue screen 0x20:auto,  0x10:enable
	{0x5F, 0x00},			//Release RESET
	{0x28, 0x68},			//Luma Contrast (0x80)
	{0x29, 0x18},			//Luma Brightness (0x20)
	//{0x30, 0x05},			//Luma Peaking Normal (0x0A)
	//{0xA0, 0x03},			//Luma Peaking Control
};


tI2CRegister0 code I2CInitTablePAL[] =
{
	{0x5F, 0x01},			//RESET
	{0x0A, 0x20},
	{0x0F, 0x00},
	{0x11, 0x0C},
	{0x18, 0x00},			//$B0,W,Y,$0000,18,00,48,83,
	{0x19, 0x0A},			//0x0A, 0x08
	//{0x19, 0x08},
	//{0x1A, 0x83},
	{0x20, 0x12},			//Video Source: PAL-I,B,G,H.D,N
	//{0x20, 0x18},			//Video Source: SECAM
	{0x21, 0x09},
	{0x59, 0x8A},			//Video 0:Odd Fields; 1:Even Fields
	//{0x59, 0x0A},			//Video 1:Odd Fields; 0:Even Fields
	{0xD2, 0x26},
	{0xD6, 0x01},
	{0xE0, 0xB0},
	
	{0x38, 0x2A},
	{0x39, 0x09},
	{0x3A, 0x8A},
	{0x3B, 0xCB},
	//{0x27, 0x20},		//blue screen 0x20:auto,  0x10:enable
	{0x5F, 0x00},			//Release RESET
	{0x28, 0x68},			//Luma Contrast (0x80)
	{0x29, 0x18},			//Luma Brightness (0x20)
	//{0x30, 0x05},			//Luma Peaking Normal (0x0A)
	//{0xA0, 0x03},			//Luma Peaking Control
};

	#endif // ZT3120_DECODER


tI2CRegister1 code I2CInitTableCommon[] =
{
	#ifdef SENSOR_ONCHIP_LDO
	{0x3109, 0x84}, // Turn on NT99141 1.5V LDO
	#else  // SENSOR_ONCHIP_LDO
	{0x3109, 0x04}, // Turn off NT99141 1.5V LDO
	#endif // SENSOR_ONCHIP_LDO

	{0x3040, 0x04},
	{0x3041, 0x02},
	{0x3042, 0xFF},
	{0x3043, 0x08},
	{0x3052, 0xE0},
	{0x305F, 0x33},
	{0x3100, 0x07},
	{0x3106, 0x03},
	{0x3108, 0x00},
	{0x3110, 0x22},
	{0x3111, 0x57},
	{0x3112, 0x22},
	{0x3113, 0x55},
	{0x3114, 0x05},
	{0x3135, 0x00},
	{0x32F0, 0x01},
	{0x3290, 0x01},
	{0x3291, 0xA0},
	{0x3296, 0x01},
	{0x3297, 0x73},
	// AWB settings
	{0x3250, 0xC0},
	{0x3251, 0x00},
	{0x3252, 0xDF},
	{0x3253, 0x85},
	{0x3254, 0x00},
	{0x3255, 0xEB},
	{0x3256, 0x81},
	{0x3257, 0x40},
	{0x329B, 0x01},
	{0x32A1, 0x00},
	{0x32A2, 0xA0},
	{0x32A3, 0x01},
	{0x32A4, 0xA0},
	{0x32A5, 0x01},
	{0x32A6, 0x18},
	{0x32A7, 0x01},
	{0x32A8, 0xE0},

	{0x32F0, 0x00}, // CbYCrY
	{0x3336, 0x14},
	// Lens Shadding Correction
	{0x3210, 0x16},
	{0x3211, 0x19},
	{0x3212, 0x16},
	{0x3213, 0x14},
	{0x3214, 0x15},
	{0x3215, 0x18},
	{0x3216, 0x15},
	{0x3217, 0x14},
	{0x3218, 0x15},
	{0x3219, 0x18},
	{0x321A, 0x15},
	{0x321B, 0x14},
	{0x321C, 0x14},
	{0x321D, 0x17},
	{0x321E, 0x14},
	{0x321F, 0x12},
	{0x3231, 0x74},
	{0x3232, 0xC4},
	// Gamma
	{0x3270, 0x00},
	{0x3271, 0x0C},
	{0x3272, 0x18},
	{0x3273, 0x32},
	{0x3274, 0x44},
	{0x3275, 0x54},
	{0x3276, 0x70},
	{0x3277, 0x88},
	{0x3278, 0x9D},
	{0x3279, 0xB0},
	{0x327A, 0xCF},
	{0x327B, 0xE2},
	{0x327C, 0xEF},
	{0x327D, 0xF7},
	{0x327E, 0xFF},
	//{0x3060, 0x01}, // Update Registers
	// Color Correction and Transform Matrix
	{0x3302, 0x00},
	{0x3303, 0x40},
	{0x3304, 0x00},
	{0x3305, 0x96},
	{0x3306, 0x00},
	{0x3307, 0x29},
	{0x3308, 0x07},
	{0x3309, 0xBA},
	{0x330A, 0x06},
	{0x330B, 0xF5},
	{0x330C, 0x01},
	{0x330D, 0x51},
	{0x330E, 0x01},
	{0x330F, 0x30},
	{0x3310, 0x07},
	{0x3311, 0x16},
	{0x3312, 0x07},
	{0x3313, 0xBA},
	//////
	{0x3326, 0x02},
	{0x3327, 0x0A},
	{0x3328, 0x0A},
	{0x3329, 0x06},
	{0x332A, 0x06},
	{0x332B, 0x1C},
	{0x332C, 0x1C},
	{0x332D, 0x00},
	{0x332E, 0x1D},
	{0x332F, 0x1F},
	{0x32F6, 0x0F},
	{0x32F9, 0x42},
	{0x32FA, 0x24},
	{0x3325, 0x4A},
	{0x3330, 0x00},
	{0x3331, 0x0A},
	{0x3332, 0xFF},
	{0x3338, 0x30},
	{0x3339, 0x84},
	{0x333A, 0x48},
	{0x333F, 0x07},
	{0x3360, 0x10},
	{0x3361, 0x18},
	{0x3362, 0x1f},
	{0x3363, 0x37},
	{0x3364, 0x80},
	{0x3365, 0x80},
	{0x3366, 0x68},
	{0x3367, 0x60},
	#if 1 // NTK K.H. Modified on Jan 31, 2013
	{0x3368, 0x90},
	{0x3369, 0x80},
	{0x336A, 0x70},
	{0x336B, 0x60},
	#endif // NTK K.H. Modified on Jan 31, 2013
	#if 0  // NTK Initial Setting
	{0x3368, 0x30},
	{0x3369, 0x28},
	{0x336A, 0x20},
	{0x336B, 0x10},
	#endif // NTK Initial Setting
	{0x336C, 0x00},
	{0x336D, 0x20},
	{0x336E, 0x1C},
	{0x336F, 0x18},
	#if 1 // NTK K.H. Modified on Jan 31, 2013
	{0x3370, 0x18},
	{0x3371, 0x28},
	{0x3372, 0x2C},
	{0x3373, 0x30},
	{0x3374, 0x30},
	{0x3375, 0x0C},
	{0x3376, 0x12},
	{0x3377, 0x18},
	{0x3378, 0x1C},
	#endif // NTK K.H. Modified on Jan 31, 2013
	#if 0  // NTK Initial Setting
	{0x3370, 0x10},
	{0x3371, 0x38},
	{0x3372, 0x3C},
	{0x3373, 0x3F},
	{0x3374, 0x3F},
	{0x3378, 0x50},
	#endif // NTK Initial Setting
	{0x338A, 0x34},
	{0x338B, 0x7F},
	{0x338C, 0x10},
	{0x338D, 0x23},
	{0x338E, 0x7F},
	{0x338F, 0x14},
	// Driving ability
	//{0x3068, 0x01}, // 0:2mA, 1:4mA, 2:6mA, 3:8mA for I2C SCL and SDA
	// marked following lines to lower driving current from NT99141 - by Wythe at Sep 18, 2012.
	{0x3069, DRIVING_ABILITY}, // 0:2mA, 1:4mA, 2:6mA, 3:8mA for HSYNC, VSYNC, and D0 - D9
	{0x306A, DRIVING_ABILITY}, // 0:2mA, 1:4mA, 2:6mA, 3:8mA for PCLK
};

tI2CRegister1 code I2CInitTable50HzHD[] =
{
	#ifdef MCLK_24_PCLK_74_30_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 50 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x5A},
	{0x32C1, 0x5A},
	{0x32C2, 0x5A},
	{0x32C3, 0x04},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xDE},
	{0x32C9, 0x5E},
	{0x32CA, 0x6A},
	{0x32CB, 0x6A},
	{0x32CC, 0x72},
	{0x32CD, 0x72},
	{0x32DB, 0x7B},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	//{0x32e0, 0x05}, // Scaler_Out_Size_X //
	//{0x32e1, 0x00},
	//{0x32e2, 0x02}, // Scaler_Out_Size_Y //
	//{0x32e3, 0xd0},
	// PLL settings
	{0x3028, 0x24}, // PLL_CLK = 24 * (40+1) / (2 * (2+1) * (0+1)) = 148
	{0x3029, 0x20}, //
	{0x302A, 0x04}, // P_CLK = 148 / (2^1) = 74
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2d3=723
	{0x3009, 0xd3},
	{0x300a, 0x06}, // line length // 0x683=1667
	{0x300b, 0x83},
	{0x300c, 0x02}, // frame length // 0x2E3=739
	{0x300d, 0xE3},
	{0x300e, 0x05}, // x output size // 0x500=1280
	{0x300f, 0x00},
	{0x3010, 0x02}, // y output size // 0x2d0=720
	{0x3011, 0xd0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_74_30_FPS
	#ifdef MCLK_24_PCLK_72_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 50 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x60},
	{0x32C2, 0x60},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xD8},
	{0x32C9, 0x60},
	{0x32CA, 0x70},
	{0x32CB, 0x70},
	{0x32CC, 0x78},
	{0x32CD, 0x78},
	{0x32DB, 0x7A},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	//{0x32e0, 0x05}, // Scaler_Out_Size_X //
	//{0x32e1, 0x00},
	//{0x32e2, 0x02}, // Scaler_Out_Size_Y //
	//{0x32e3, 0xd0},
	// PLL settings
	{0x3028, 0x0B}, // PLL_CLK = 24 * (11+1) / (2 * (0+1) * (0+1)) = 144
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 144 / (2^1) = 72
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
	{0x300A, 0x06}, // line length // 0x67C=1660
	{0x300B, 0x83},
	{0x300C, 0x03}, // frame length // 0x2F1=753
	{0x300D, 0x83},
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_72_24_FPS
	#ifdef MCLK_24_PCLK_60_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 50 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x64},
	{0x32C1, 0x63},
	{0x32C2, 0x63},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xB4},
	{0x32C9, 0x63},
	{0x32CA, 0x73},
	{0x32CB, 0x73},
	{0x32CC, 0x7B},
	{0x32CD, 0x7C},
	{0x32DB, 0x76},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	//{0x32e0, 0x05}, // Scaler_Out_Size_X //
	//{0x32e1, 0x00},
	//{0x32e2, 0x02}, // Scaler_Out_Size_Y //
	//{0x32e3, 0xd0},
	// PLL settings
	{0x3028, 0x09}, // PLL_CLK = 24 * (9+1) / (2 * (0+1) * (0+1)) = 120
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 120 / (2^1) = 60
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
	{0x300A, 0x06}, // line length // 0x67C=1660
	{0x300B, 0x83},
	{0x300C, 0x03}, // frame length // 0x2F1=753
	{0x300D, 0x83},
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_60_24_FPS
};

tI2CRegister1 code I2CInitTable60HzHD[] =
{
	#ifdef MCLK_24_PCLK_74_30_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 60 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x5F},
	{0x32C2, 0x5F},
	{0x32C3, 0x04},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xB9},
	{0x32C9, 0x63},
	{0x32CA, 0x6F},
	{0x32CB, 0x6F},
	{0x32CC, 0x77},
	{0x32CD, 0x78},
	{0x32DB, 0x77},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	{0x32e0, 0x05}, //  Scaler_Out_Size_X //
	{0x32e1, 0x00},
	{0x32e2, 0x02}, //  Scaler_Out_Size_Y //
	{0x32e3, 0xd0},
	// PLL settings
	{0x3028, 0x24}, // PLL_CLK = 24 * (40+1) / (2 * (2+1) * (0+1)) = 148
	{0x3029, 0x20}, //
	{0x302A, 0x04}, // P_CLK = 148 / (2^1) = 74
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2d3=723
	{0x3009, 0xd3},
	{0x300a, 0x06}, // line length // 0x683=1667
	{0x300b, 0x83},
	{0x300c, 0x02}, // frame length // 0x2E3=739
	{0x300d, 0xE3},
	{0x300e, 0x05}, // x output size // 0x500=1280
	{0x300f, 0x00},
	{0x3010, 0x02}, // y output size // 0x2d0=720
	{0x3011, 0xd0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_74_30_FPS
	#ifdef MCLK_24_PCLK_72_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 60 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x64},
	{0x32C1, 0x63},
	{0x32C2, 0x63},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xB4},
	{0x32C9, 0x63},
	{0x32CA, 0x73},
	{0x32CB, 0x73},
	{0x32CC, 0x7B},
	{0x32CD, 0x7C},
	{0x32DB, 0x76},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	//{0x32e0, 0x05}, // Scaler_Out_Size_X //
	//{0x32e1, 0x00},
	//{0x32e2, 0x02}, // Scaler_Out_Size_Y //
	//{0x32e3, 0xd0},
	// PLL settings
	{0x3028, 0x0B}, // PLL_CLK = 24 * (11+1) / (2 * (0+1) * (0+1)) = 144
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 144 / (2^1) = 72
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
	{0x300A, 0x06}, // line length // 0x67C=1660
	{0x300B, 0x83},
	{0x300C, 0x03}, // frame length // 0x2F1=753
	{0x300D, 0x83},
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_72_24_FPS
	#ifdef MCLK_24_PCLK_60_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 60 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x80},
	{0x32C1, 0x7F},
	{0x32C2, 0x7F},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0x97},
	{0x32C9, 0x7F},
	{0x32CA, 0x9F},
	{0x32CB, 0x9F},
	{0x32CC, 0x9F},
	{0x32CD, 0xA0},
	{0x32DB, 0x72},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	//{0x32e0, 0x05}, // Scaler_Out_Size_X //
	//{0x32e1, 0x00},
	//{0x32e2, 0x02}, // Scaler_Out_Size_Y //
	//{0x32e3, 0xd0},
	// PLL settings
	{0x3028, 0x09}, // PLL_CLK = 24 * (9+1) / (2 * (0+1) * (0+1)) = 120
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 120 / (2^1) = 60
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
	{0x300a, 0x06}, // line length // 0x67C=1660
	{0x300b, 0x7C},
	{0x300c, 0x02}, // frame length // 0x2F1=753
	{0x300d, 0xF1},
	{0x300e, 0x05}, // x output size // 0x500=1280
	{0x300f, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_60_24_FPS
};

#ifdef SUPPORT_SENSOR_SCALING
tI2CRegister1 code I2CInitTable50HzScaledHD[] =
{
	#ifdef MCLK_24_PCLK_80_24_FPS
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x60},
	{0x32C2, 0x60},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0xC8},
	{0x32C9, 0x60},
	{0x32CA, 0x80},
	{0x32CB, 0x80},
	{0x32CC, 0x80},
	{0x32CD, 0x80},
	{0x32DB, 0x79},
	// Output Resolution
		#ifdef SENSOR_CROP_960x544
	{0x32E0, 0x03}, // Scaler_Out_Size_X // 0x3C0 = 960
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y // 0x220 = 544
	{0x32E3, 0x20},
		#else  // SENSOR_CROP_960x544
	{0x32E0, 0x03}, // Scaler_Out_Size_X // 0x3C0 = 960
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y // 0x258 = 600
	{0x32E3, 0x58},
		#endif // SENSOR_CROP_960x544
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x55},
	{0x32E6, 0x00},
	{0x32E7, 0x33},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// PLL settings
	{0x3028, 0x13}, // PLL_CLK = 24 * (19+1) / (2 * (2+1) * (0+1)) = 80
	{0x3029, 0x20}, //
	{0x302A, 0x00}, // P_CLK = 80 / (2^0) = 80
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
		#ifdef SENSOR_CROP_960x544
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start // 4+34 = 38 = 0x26
	{0x3005, 0x26},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 723-34 = 689 = 0x2B1
	{0x3009, 0xB1},
		#else  // SENSOR_CROP_960x544
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
		#endif // SENSOR_CROP_960x544
	{0x300A, 0x07}, // line length // 0x7D0=2000
	{0x300B, 0xD0},
	{0x300C, 0x03}, // frame length // 0x341=833
	{0x300D, 0x41},
		#ifdef SENSOR_CROP_960x544
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x28C=652
	{0x3011, 0x8C},
		#else  // SENSOR_CROP_960x544
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
		#endif // SENSOR_CROP_960x544
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7F},	// enable scaler/ae/awb
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_80_24_FPS
	#ifdef MCLK_24_PCLK_72_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 50 Hz Anti-Flicker
		#if 0  // NTK_KH_20120103
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x60},
	{0x32C2, 0x60},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0xB4},
	{0x32C9, 0x60},
	{0x32CA, 0x80},
	{0x32CB, 0x80},
	{0x32CC, 0x80},
	{0x32CD, 0x80},
	{0x32DB, 0x76},
		#else  // NTK_KH_20120103
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x60},
	{0x32C2, 0x60},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xD8},
	{0x32C9, 0x60},
	{0x32CA, 0x70},
	{0x32CB, 0x70},
	{0x32CC, 0x78},
	{0x32CD, 0x78},
	{0x32DB, 0x7A},
		#endif // NTK_KH_20120103
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	{0x32E0, 0x03}, // Scaler_Out_Size_X //
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y //
	{0x32E3, 0x20},
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x55},
	{0x32E6, 0x00},
	{0x32E7, 0x53},
	// PLL settings
	{0x3028, 0x0B}, // PLL_CLK = 24 * (11+1) / (2 * (0+1) * (0+1)) = 144
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 144 / (2^1) = 72
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
		#if 0  // NTK_KH_20120103
	{0x300A, 0x07}, // line length // 0x7D0=2000
	{0x300B, 0xD0},
	{0x300C, 0x02}, // frame length // 0x2EE=750
	{0x300D, 0xFE},
		#else  // NTK_KH_20120103
	{0x300A, 0x06}, // line length // 0x683=1667
	{0x300B, 0x83},
	{0x300C, 0x03}, // frame length // 0x383=899
	{0x300D, 0x83},
		#endif // NTK_KH_20120103
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7F},	// enable scaler/ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_72_24_FPS
	#ifdef MCLK_24_PCLK_60_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 50 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x64},
	{0x32C1, 0x63},
	{0x32C2, 0x63},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xB4},
	{0x32C9, 0x63},
	{0x32CA, 0x73},
	{0x32CB, 0x73},
	{0x32CC, 0x7B},
	{0x32CD, 0x7C},
	{0x32DB, 0x76},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	{0x32E0, 0x03}, // Scaler_Out_Size_X //
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y //
	{0x32E3, 0x20},
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x55},
	{0x32E6, 0x00},
	{0x32E7, 0x53},
	// PLL settings
	{0x3028, 0x09}, // PLL_CLK = 24 * (9+1) / (2 * (0+1) * (0+1)) = 120
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 120 / (2^1) = 60
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
	{0x300A, 0x06}, // line length // 0x67C=1660
	{0x300B, 0x83},
	{0x300C, 0x03}, // frame length // 0x2F1=753
	{0x300D, 0x83},
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_60_24_FPS
};

tI2CRegister1 code I2CInitTable60HzScaledHD[] =
{
	#ifdef MCLK_24_PCLK_80_24_FPS
	{0x32BF, 0x60},
	{0x32C0, 0x64},
	{0x32C1, 0x64},
	{0x32C2, 0x64},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0xA7},
	{0x32C9, 0x64},
	{0x32CA, 0x84},
	{0x32CB, 0x84},
	{0x32CC, 0x84},
	{0x32CD, 0x84},
	{0x32DB, 0x74},
	// Output Resolution
		#ifdef SENSOR_CROP_960x544
	{0x32E0, 0x03}, // Scaler_Out_Size_X // 0x3C0 = 960
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y // 0x220 = 544
	{0x32E3, 0x20},
		#else  // SENSOR_CROP_960x544
	{0x32E0, 0x03}, // Scaler_Out_Size_X // 0x3C0 = 960
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y // 0x258 = 600
	{0x32E3, 0x58},
		#endif // SENSOR_CROP_960x544
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x55},
	{0x32E6, 0x00},
	{0x32E7, 0x33},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// PLL settings
	{0x3028, 0x13}, // PLL_CLK = 24 * (19+1) / (2 * (2+1) * (0+1)) = 80
	{0x3029, 0x20}, //
	{0x302A, 0x00}, // P_CLK = 80 / (2^0) = 80
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
		#ifdef SENSOR_CROP_960x544
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start // 4+34 = 38 = 0x26
	{0x3005, 0x26},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 723-34 = 689 = 0x2B1
	{0x3009, 0xB1},
		#else  // SENSOR_CROP_960x544
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
		#endif // SENSOR_CROP_960x544
	{0x300A, 0x07}, // line length // 0x7D0=2000
	{0x300B, 0xD0},
	{0x300C, 0x03}, // frame length // 0x341=833
	{0x300D, 0x41},
		#ifdef SENSOR_CROP_960x544
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x28C=652
	{0x3011, 0x8C},
		#else  // SENSOR_CROP_960x544
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
		#endif // SENSOR_CROP_960x544
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7F},	// enable scaler/ae/awb
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_80_24_FPS
	#ifdef MCLK_24_PCLK_72_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 60 Hz Anti-Flicker
		#if 0  // NTK_KH_20120103
	{0x32BF, 0x60},
	{0x32C0, 0x64},
	{0x32C1, 0x64},
	{0x32C2, 0x64},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0x96},
	{0x32C9, 0x64},
	{0x32CA, 0x84},
	{0x32CB, 0x84},
	{0x32CC, 0x84},
	{0x32CD, 0x84},
	{0x32DB, 0x72},
		#else  // NTK_KH_20120103
	{0x32BF, 0x60},
	{0x32C0, 0x64},
	{0x32C1, 0x63},
	{0x32C2, 0x63},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xB4},
	{0x32C9, 0x63},
	{0x32CA, 0x73},
	{0x32CB, 0x73},
	{0x32CC, 0x7B},
	{0x32CD, 0x7C},
	{0x32DB, 0x76},
		#endif // NTK_KH_20120103
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	{0x32E0, 0x03}, // Scaler_Out_Size_X //
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y //
	{0x32E3, 0x20},
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x55},
	{0x32E6, 0x00},
	{0x32E7, 0x53},
	// PLL settings
	{0x3028, 0x0B}, // PLL_CLK = 24 * (11+1) / (2 * (0+1) * (0+1)) = 144
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 144 / (2^1) = 72
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
		#if 0  // NTK_KH_20120103
	{0x300A, 0x07}, // line length // 0x7D0=2000
	{0x300B, 0xD0},
	{0x300C, 0x02}, // frame length // 0x2EE=750
	{0x300D, 0xFE},
		#else  // NTK_KH_20120103
	{0x300A, 0x06}, // line length // 0x683=1667
	{0x300B, 0x83},
	{0x300C, 0x03}, // frame length // 0x383=899
	{0x300D, 0x83},
		#endif // NTK_KH_20120103
	{0x300E, 0x05}, // x output size // 0x500=1280
	{0x300F, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7F},	// enable scaler/ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_72_24_FPS
	#ifdef MCLK_24_PCLK_60_24_FPS
	//{0x3012, 0x00}, // Default Integration Time
	//{0x3013, 0xff},
	// 60 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x80},
	{0x32C1, 0x7F},
	{0x32C2, 0x7F},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0x97},
	{0x32C9, 0x7F},
	{0x32CA, 0x9F},
	{0x32CB, 0x9F},
	{0x32CC, 0x9F},
	{0x32CD, 0xA0},
	{0x32DB, 0x72},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// Output Resolution
	{0x32E0, 0x03}, // Scaler_Out_Size_X //
	{0x32E1, 0xC0},
	{0x32E2, 0x02}, // Scaler_Out_Size_Y //
	{0x32E3, 0x20},
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x55},
	{0x32E6, 0x00},
	{0x32E7, 0x53},
	// PLL settings
	{0x3028, 0x09}, // PLL_CLK = 24 * (9+1) / (2 * (0+1) * (0+1)) = 120
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 120 / (2^1) = 60
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0x04},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x05}, // x end  // 0x503=1283
	{0x3007, 0x03},
	{0x3008, 0x02}, // y end  // 0x2D3=723
	{0x3009, 0xD3},
	{0x300a, 0x06}, // line length // 0x67C=1660
	{0x300b, 0x7C},
	{0x300c, 0x02}, // frame length // 0x2F1=753
	{0x300d, 0xF1},
	{0x300e, 0x05}, // x output size // 0x500=1280
	{0x300f, 0x00},
	{0x3010, 0x02}, // y output size // 0x2D0=720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x3F},	// enable ae/awb
	//{0x3201, 0x1F},	// disable AE/ enable AWB
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_60_24_FPS
};
#endif // SUPPORT_SENSOR_SCALING

tI2CRegister1 code I2CInitTable50HzVGA[] =
{
	#ifdef MCLK_24_PCLK_XX_30_FPS
	//{0x3012, 0x01}, // Default Integration Time
	//{0x3013, 0x75},
	//{0x301d, 0x30},
	// 50 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x5A},
	{0x32C1, 0x5A},
	{0x32C2, 0x5A},
	{0x32C3, 0x04},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xE0},
	{0x32C9, 0x5E},
	{0x32CA, 0x6A},
	{0x32CB, 0x6A},
	{0x32CC, 0x72},
	{0x32CD, 0x72},
	{0x32DB, 0x7B},
	// Output Resolution
	{0x32e0, 0x02}, // Scaler_Out_Size_X // 0x280 = 640
	{0x32e1, 0x80},
	{0x32e2, 0x01}, // Scaler_Out_Size_Y // 0x1e0 = 480
	{0x32e3, 0xe0},
	{0x32e4, 0x00}, // Scaling Factor
	{0x32e5, 0x80},
	{0x32e6, 0x00},
	{0x32e7, 0x80},
	// PLL settings
	{0x302A, 0x00}, // PLL setting
	{0x3028, 0x09}, // PLL
	{0x3029, 0x00},
	{0x302A, 0x04}, // PLL run // 0x04, 0x08
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0xa4},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x04}, // x end	// 0x463 = 1123
	{0x3007, 0x63},
	{0x3008, 0x02}, // y end	// 0x2d3 = 723
	{0x3009, 0xd3},
	{0x300a, 0x05}, // line length // 0x53c = 1340
	{0x300b, 0x3c},
	{0x300c, 0x02}, // frame length // 0x2ea = 746
	{0x300d, 0xea},
	{0x300e, 0x03}, // x output size // 0x3c0 = 960
	{0x300f, 0xc0},
	{0x3010, 0x02}, // y output size // 0x2d0 = 720
	{0x3011, 0xd0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7f}, // enable AE/AWB
	//{0x3201, 0x5F}, // disable AE
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_XX_30_FPS
	#ifdef MCLK_24_PCLK_60_30_FPS
	//{0x3012, 0x01}, // Default Integration Time
	//{0x3013, 0x75},
	// 50 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x5A},
	{0x32C1, 0x5A},
	{0x32C2, 0x5A},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0xE0},
	{0x32C9, 0x5A},
	{0x32CA, 0x7A},
	{0x32CB, 0x7A},
	{0x32CC, 0x7A},
	{0x32CD, 0x7A},
	{0x32DB, 0x7B},
	// Output Resolution
	{0x32E0, 0x02}, // Scaler_Out_Size_X // 0x280 = 640
	{0x32E1, 0x80},
	{0x32E2, 0x01}, // Scaler_Out_Size_Y // 0x1e0 = 480
	{0x32E3, 0xE0},
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x80},
	{0x32E6, 0x00},
	{0x32E7, 0x80},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// PLL settings
	{0x3028, 0x09}, // PLL_CLK = 24 * (9+1) / (2 * (0+1) * (0+1)) = 120
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 120 / (2^1) = 60
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0xA4},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x04}, // x end	// 0x463 = 1123
	{0x3007, 0x63},
	{0x3008, 0x02}, // y end	// 0x2D3 = 723
	{0x3009, 0xD3},
	{0x300a, 0x05}, // line length // 0x53C = 1340
	{0x300b, 0x3C},
	{0x300c, 0x02}, // frame length // 0x2EA = 746
	{0x300d, 0xEA},
	{0x300e, 0x03}, // x output size // 0x3C0 = 960
	{0x300f, 0xC0},
	{0x3010, 0x02}, // y output size // 0x2D0 = 720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7F}, // enable Scaler/AE/AWB
	//{0x3201, 0x5F}, // disable AE
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06},
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_60_30_FPS
};

tI2CRegister1 code I2CInitTable60HzVGA[] =
{
	#ifdef MCLK_24_PCLK_XX_30_FPS
	//{0x3012, 0x01}, // Default Integration Time
	//{0x3013, 0x75},
	//{0x301d, 0x30},
	// 60 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x5F},
	{0x32C2, 0x5F},
	{0x32C3, 0x04},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x10},
	{0x32C6, 0x18},
	{0x32C7, 0x00},
	{0x32C8, 0xBB},
	{0x32C9, 0x63},
	{0x32CA, 0x6F},
	{0x32CB, 0x6F},
	{0x32CC, 0x77},
	{0x32CD, 0x78},
	{0x32DB, 0x77},
	// Output Resolution
	{0x32e0, 0x02}, // Scaler_Out_Size_X // 0x280 = 640
	{0x32e1, 0x80},
	{0x32e2, 0x01}, // Scaler_Out_Size_Y // 0x1e0 = 480
	{0x32e3, 0xe0},
	{0x32e4, 0x00}, // Scaling Factor
	{0x32e5, 0x80},
	{0x32e6, 0x00},
	{0x32e7, 0x80},
	// PLL settings
	{0x3028, 0x09}, // PLL
	{0x3029, 0x00},
	{0x302A, 0x04}, // PLL run // 0x04, 0x08
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0xa4},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x04}, // x end	// 0x463 = 1123
	{0x3007, 0x63},
	{0x3008, 0x02}, // y end	// 0x2d3 = 723
	{0x3009, 0xd3},
	{0x300a, 0x05}, // line length // 0x53c = 1340
	{0x300b, 0x3c},
	{0x300c, 0x02}, // frame length // 0x2ea = 746
	{0x300d, 0xea},
	{0x300e, 0x03}, // x output size // 0x3c0 = 960
	{0x300f, 0xc0},
	{0x3010, 0x02}, // y output size // 0x2d0 = 720
	{0x3011, 0xd0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7f}, // enable Scaler/AE/AWB
	//{0x3201, 0x5F}, // disable AE
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06}, // Output Streaming
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_XX_30_FPS
	#ifdef MCLK_24_PCLK_60_30_FPS
	//{0x3012, 0x01}, // Default Integration Time
	//{0x3013, 0x75},
	// 60 Hz Anti-Flicker
	{0x32BF, 0x60},
	{0x32C0, 0x60},
	{0x32C1, 0x5F},
	{0x32C2, 0x5F},
	{0x32C3, 0x00},
	{0x32C4, SENSOR_AGC_GAIN},
	{0x32C5, 0x20},
	{0x32C6, 0x20},
	{0x32C7, 0x00},
	{0x32C8, 0xBB},
	{0x32C9, 0x5F},
	{0x32CA, 0x7F},
	{0x32CB, 0x7F},
	{0x32CC, 0x7F},
	{0x32CD, 0x80},
	{0x32DB, 0x77},
	// Output Resolution
	{0x32E0, 0x02}, // Scaler_Out_Size_X // 0x280 = 640
	{0x32E1, 0x80},
	{0x32E2, 0x01}, // Scaler_Out_Size_Y // 0x1e0 = 480
	{0x32E3, 0xE0},
	{0x32E4, 0x00}, // Scaling Factor
	{0x32E5, 0x80},
	{0x32E6, 0x00},
	{0x32E7, 0x80},
	// Modules Enable Controls
	{0x3200, 0x3E}, // enables
	{0x3201, 0x0F}, // Noise Reduction en, Edge Enhance en, Color Correction en, Special Effect en
	// PLL settings
	{0x3028, 0x09}, // PLL_CLK = 24 * (9+1) / (2 * (0+1) * (0+1)) = 120
	{0x3029, 0x00}, //
	{0x302A, 0x04}, // P_CLK = 120 / (2^1) = 60
	{0x3022, 0x24+SENSOR_VERTICAL_FLIP+SENSOR_HORIZONTAL_MIRROR}, // read mode 0
	{0x3023, 0x24}, // read mode 1
	// Sensor Array Active Region
	{0x3002, 0x00}, // x start
	{0x3003, 0xA4},
	{0x3004, 0x00}, // y start
	{0x3005, 0x04},
	{0x3006, 0x04}, // x end	// 0x463 = 1123
	{0x3007, 0x63},
	{0x3008, 0x02}, // y end	// 0x2D3 = 723
	{0x3009, 0xD3},
	{0x300a, 0x05}, // line length // 0x53C = 1340
	{0x300b, 0x3C},
	{0x300c, 0x02}, // frame length // 0x2EA = 746
	{0x300d, 0xEA},
	{0x300e, 0x03}, // x output size // 0x3C0 = 960
	{0x300f, 0xC0},
	{0x3010, 0x02}, // y output size // 0x2D0 = 720
	{0x3011, 0xD0},
	// soc auto exposure
	{0x32B8, 0x3F},
	{0x32B9, 0x31},
	{0x32BB, SENSOR_AE_SPEED},
	{0x32BC, 0x38},
	{0x32BD, 0x3C},
	{0x32BE, 0x34},
	{0x3201, 0x7F}, // enable Scaler/AE/AWB
	//{0x3201, 0x5F}, // disable AE
	//{0x3025, 0x02}, // test pattern
	{0x3021, 0x06},
	{0x3060, 0x01},
	#endif // MCLK_24_PCLK_60_30_FPS
};


unsigned char fnDoInitSensor(
	unsigned char ucResolution)
{
	{
	#ifdef SUPPORT_D2_PIO
		fnD2SetPIO0(0); // Set pin RESET low
		fnD2SetPIO1(0); // Set pin RESET low
		fnD2IdleDelay(100); // count 100 around 12ms
	#endif // SUPPORT_D2_PIO
		D2DisableSensorClock();
		fnD2IdleDelay(100); // count 100 around 12ms
		D2WriteSensorClock(CLK_SENSOR);  // Set Sensor Clock in MHz
		fnD2IdleDelay(100); // count 100 around 12ms
	#ifdef SUPPORT_D2_PIO
		fnD2SetPIO0(1); // Set pin RESET high
		fnD2SetPIO1(1); // Set pin RESET high
		fnD2IdleDelay(100); // count 100 around 60ms
	#endif // SUPPORT_D2_PIO
		fnI2cWriteTable1(I2CInitTableCommon, sizeof(I2CInitTableCommon) / sizeof(tI2CRegister1));
	}
	ucResetControl = 0x74;      // 40:SIU Reset, 20:IPU Reset, 10:SOU Reset, 04: DRAM Reset
	switch (ucResolution)
	{
	case D2_RESOLUTION_VGA_60Hz:
	#ifdef SUPPORT_SENSOR_SCALING
	case D2_RESOLUTION_VGA_60Hz+D2_RESOLUTION_SCALED_HD_OFFSET:
	#endif // SUPPORT_SENSOR_SCALING
		fnI2cWriteTable0(I2CInitTableNTSC, sizeof(I2CInitTableNTSC) / sizeof(tI2CRegister0));
		fnI2cWriteTable1(I2CInitTable60HzVGA, sizeof(I2CInitTable60HzVGA) / sizeof(tI2CRegister1));
		break;
	case D2_RESOLUTION_VGA_50Hz:
	#ifdef SUPPORT_SENSOR_SCALING
	case D2_RESOLUTION_VGA_50Hz+D2_RESOLUTION_SCALED_HD_OFFSET:
	#endif // SUPPORT_SENSOR_SCALING
		fnI2cWriteTable0(I2CInitTablePAL, sizeof(I2CInitTablePAL) / sizeof(tI2CRegister0));
		fnI2cWriteTable1(I2CInitTable50HzVGA, sizeof(I2CInitTable50HzVGA) / sizeof(tI2CRegister1));
		break;
	case D2_RESOLUTION_HD_60Hz:
		fnI2cWriteTable0(I2CInitTableNTSC, sizeof(I2CInitTableNTSC) / sizeof(tI2CRegister0));
		fnI2cWriteTable1(I2CInitTable60HzHD, sizeof(I2CInitTable60HzHD) / sizeof(tI2CRegister1));
		break;
	case D2_RESOLUTION_HD_50Hz:
		fnI2cWriteTable0(I2CInitTablePAL, sizeof(I2CInitTablePAL) / sizeof(tI2CRegister0));
		fnI2cWriteTable1(I2CInitTable50HzHD, sizeof(I2CInitTable50HzHD) / sizeof(tI2CRegister1));
		break;
	#ifdef SUPPORT_SENSOR_SCALING
	case D2_RESOLUTION_HD_60Hz+D2_RESOLUTION_SCALED_HD_OFFSET:
		fnI2cWriteTable0(I2CInitTableNTSC, sizeof(I2CInitTableNTSC) / sizeof(tI2CRegister0));
		fnI2cWriteTable1(I2CInitTable60HzScaledHD, sizeof(I2CInitTable60HzScaledHD) / sizeof(tI2CRegister1));
		break;
	case D2_RESOLUTION_HD_50Hz+D2_RESOLUTION_SCALED_HD_OFFSET:
		fnI2cWriteTable0(I2CInitTablePAL, sizeof(I2CInitTablePAL) / sizeof(tI2CRegister0));
		fnI2cWriteTable1(I2CInitTable50HzScaledHD, sizeof(I2CInitTable50HzScaledHD) / sizeof(tI2CRegister1));
		break;
	#endif // SUPPORT_SENSOR_SCALING
	default:
		ucResetControl = 0x00;
		return FAILURE;
	}
	ucResetControl = 0x00;
	return SUCCESS;
}

void fnDoHouseKeeping()
{
	if (nD2Mode != D2_OPERATION_IDLE)
		fnD2TableVerify();
}

void fnDoInitialization()
{

	I2CWorkItem0.I2CConfiguration = SENSOR0_I2C_CONFIG;
	I2CWorkItem0.I2CSlaveAddress  = SENSOR0_I2C_SLAVE;
	I2CWorkItem1.I2CConfiguration = SENSOR1_I2C_CONFIG;
	I2CWorkItem1.I2CSlaveAddress  = SENSOR1_I2C_SLAVE;
}

#endif // SUPPORT_D2_OPERATION
